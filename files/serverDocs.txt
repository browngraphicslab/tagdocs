Working with the TAG Server

Here is another comprehensive guide to setting up a tag server from the client’s POV: http://cs.brown.edu/research/ptc/tag/TAGUsersGuide.pdf

As a developer, you should first set up the right tools to develop the TAG Server. 
Install the following in this order:
*Some of these installations may seem incompatible with your system but make sure they are installed anyways.
**When on the installation screen please select the option "New SQL Server stand-alone installation or add features to an existing installation" 
instead of the option to upgrade sql server.
***Make sure to download all of the features available.

1. Microsoft SQL Server 2008: http://www.microsoft.com/en-us/download/details.aspx?id=20610
When asked for a user account to run SQL Server 2008, please refer to this: http://stackoverflow.com/questions/63749/what-user-account-would-you-recommend-running-the-sql-server-express-2008-servic and make the best judgment according to your system capabilities (I'm running it as Local Service and it's working fine).

You can choose to implement SQLExpress instances with Windows Authentication and/or SQL Server Authentication (which adds another layer of security with a specified login/password).

*Make sure you are installing the SQLExpress server

2. SQL Server Shared Management Objects: http://www.microsoft.com/en-us/download/details.aspx?id=30440
-depending on your system, install shared management objects
SharedManagementObjects_amd64.msi
SharedManagementObjects_ia64.msi
SharedManagementObjects_x86.msi

3. SQL Server Replication Management Object: http://www.microsoft.com/en-us/download/details.aspx?id=27596
-depending on your system, install the rmo and smo
ENU\IA64\SharedManagementObjects.msi
ENU\x64\SharedManagementObjects.msi
ENU\x86\SharedManagementObjects.msi

ENU\IA64\sql_rmo.msi
ENU\x64\sql_rmo.msi
	ENU\x86\sql_rmo.msi

4. SQL Server 2008 Management Studio: http://www.microsoft.com/en-us/download/details.aspx?id=7593

5. Checkout codebase for the TAG Server: https://github.com/browngraphicslab/tagServer with git
Here’s a copy of the TAG Server installation: http://cs.brown.edu/research/ptc/tag/tagsetup.exe for your own reference.

6. If you’re working with the TAG server while on Brown’s network, install Fiddler2 (Build for .Net2): http://www.telerik.com/download/fiddler
-Also install the EnableLoopback Utility if you’re running both the server and a copy of TAG on the same computer for easy testing: https://www.telerik.com/docs/default-source/fiddler/EnableLoopbackUtility.exe
Follow the instructions for each installation and make sure to install every package/service offered by the installer. 

7. Restart your computer. If you encounter the error: The remote procedure call failed.[0x800706be] in the SQL Server 
Configuration Manager, please download SQL 2008 R2 SP1: http://www.microsoft.com/en-us/download/details.aspx?id=26727 

Configure a SQLExpress Instance

Open the SQL Server Configuration Manager and after opening SQL Server Services in the left panel, you should be able to see the different SQL server services currently enabled. SQL Server (SQLEXPRESS) and SQL Server Browser should both be running while the SQL Server Agent remains stopped. You can change the states of these services by right clicking. If starting/stopping a service is disabled for the services you should have running, right click and open up properties. Under the service tab, set the start mode to automatic.

Now that you have SQL server set up, open Microsoft SQL Server Management Studio. If it's your first time opening this application, it will prompt you to connect to a server. If not, you can connect to a server by selecting "Connect to Object Explorer" under the Files tab. 
Please choose the following parameters:
Server type: Database Engine
Server name: <user>\SQLEXPRESS
Authentication: *your choice*

Now, a panel will open on the left side of the application showing various information about your SQLExpress instance. Under databases, you will be able to see data from the databases once you create them with the TAG Server application.
	
Starting TAG Server in Visual Studio

You should have checked out the code base for the TAG Server from git by now. Open HumBub.sln in Visual Studio (run it as an administrator!!!). Two windows should pop up, one called Login and the other called TAG Server. If it’s your first time working with the TAG Server, in the Login window, I advise you to create a new database as a starting point. Make sure to choose SQLExpress as your server instance. 

Now that you have databases to connect to, choose one in the Login window, leave the port number as is and press ok. Now, in the TAG Server window, you should see non-error messages along the lines of this:

Saving Defaults
Starting session
User set to: TAG
Serving 18 doquments, and 0 linqs.
beginning listening loop...
The first message should be "Failed to connect to server <user>\." So don’t worry about that.

Now you have a complete TAG server running on your machine!

Testing TAG Server

Now that you have the TAG Server running on your machine, you can test the server and client relationship. 
Open Fiddler2 and click on Win8 Config and a new window should open. Click on exempt all and save the changes. You should be able to test TAG on your own machine now. While the server is running, open a Win8 instance or webapp instance of TAG and click on change server. Type in localhost (or your ip address) and TAG should switch to using the server instance running on your machine.

If you want to test a TAG instance running on a different machine with a server running on your own machine, make sure you are not on a Brown network. Although the webapp should still be able to connect to your local server, the Win8 app is sandboxed and would not be able to. Check your IPv4 Address by running ipconfig in your shell. Configure your firewall in its advanced settings and set inbound and outbound rules on the TCP ports 8080, and 8086 and set it to allow connections to those ports. Now, TAG on different machines should be able to switch over to your server if you provide it with your ip address when you switch servers.

Yay! You have configured everything and you’re ready to work with the server code! :D

